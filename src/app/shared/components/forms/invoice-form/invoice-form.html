<!-- Trigger Button -->
<ui-button 
  *ngIf="!isOpen"
  className="bg-primary hover:bg-primary/90"
  (onClick)="openDialog()"
>
  <i class="icon-plus mr-2"></i>
  {{ triggerButtonText }}
</ui-button>

<!-- Modal/Dialog -->
<div 
  *ngIf="open"
  class="fixed inset-0 z-50 flex items-center justify-center"
  (click)="closeDialog()"
>
  <div class="fixed inset-0 bg-black/50"></div>
  
  <div 
    class="relative bg-white rounded-lg shadow-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"
    (click)="$event.stopPropagation()"
  >
    <div class="p-6">
      <!-- Header -->
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-semibold flex items-center gap-2">
          <i class="icon-receipt"></i>
          {{ isEditing ? 'Editar Faturamento' : 'Novo Faturamento' }}
        </h2>
        <button 
          class="text-gray-400 hover:text-gray-600"
          (click)="closeDialog()"
        >
          <i class="icon-x text-xl"></i>
        </button>
      </div>

      <!-- Form -->
      <form [formGroup]="invoiceForm" (ngSubmit)="onSubmit()" class="space-y-4">
        <!-- Cliente e Referência -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-2">
            <label for="cliente_id" class="block text-sm font-medium">
              <i class="icon-user mr-1"></i>
              Cliente *
            </label>
            <select 
              id="cliente_id" 
              formControlName="cliente_id"
              class="w-full h-10 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary"
              [class.border-red-500]="getFieldError('cliente_id')"
            >
              <option value="">Selecione o cliente</option>
              <option *ngFor="let cliente of clientesAtivos" [value]="cliente.id">
                {{ cliente.nome }}
              </option>
            </select>
            <p *ngIf="getFieldError('cliente_id')" class="text-sm text-red-500">
              {{ getFieldError('cliente_id') }}
            </p>
          </div>

          <div class="space-y-2">
            <label for="referencia" class="block text-sm font-medium">Referência *</label>
            <ui-input
              id="referencia"
              formControlName="referencia"
              placeholder="Ex: Janeiro/2024, Projeto X"
              [className]="getFieldError('referencia') ? 'border-red-500' : ''"
            ></ui-input>
            <p *ngIf="getFieldError('referencia')" class="text-sm text-red-500">
              {{ getFieldError('referencia') }}
            </p>
          </div>
        </div>

        <!-- Valores -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="space-y-2">
            <label for="valor" class="block text-sm font-medium">
              <i class="icon-dollar-sign mr-1"></i>
              Valor *
            </label>
            <ui-input
              id="valor"
              type="number"
              step="0.01"
              formControlName="valor"
              placeholder="0,00"
              [className]="getFieldError('valor') ? 'border-red-500' : ''"
            ></ui-input>
            <p *ngIf="getFieldError('valor')" class="text-sm text-red-500">
              {{ getFieldError('valor') }}
            </p>
          </div>

          <div class="space-y-2">
            <label for="custo" class="block text-sm font-medium">Custo</label>
            <ui-input
              id="custo"
              type="number"
              step="0.01"
              formControlName="custo"
              placeholder="0,00"
            ></ui-input>
          </div>

          <div class="space-y-2">
            <label for="glosa" class="block text-sm font-medium">Glosa</label>
            <ui-input
              id="glosa"
              type="number"
              step="0.01"
              formControlName="glosa"
              placeholder="0,00"
            ></ui-input>
          </div>
        </div>

        <!-- Valor Líquido (calculado automaticamente) -->
        <div class="space-y-2">
          <label for="valor_liquido" class="block text-sm font-medium text-green-600">
            Valor Líquido (calculado automaticamente)
          </label>
          <ui-input
            id="valor_liquido"
            formControlName="valor_liquido"
            placeholder="0,00"
            [readonly]="true"
            className="bg-green-50 border-green-200"
          ></ui-input>
        </div>

        <!-- Vencimento e Status -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="space-y-2">
            <label for="vencimento" class="block text-sm font-medium">
              <i class="icon-calendar mr-1"></i>
              Data de Vencimento *
            </label>
            <ui-input
              id="vencimento"
              type="date"
              formControlName="vencimento"
              [className]="getFieldError('vencimento') ? 'border-red-500' : ''"
            ></ui-input>
            <p *ngIf="getFieldError('vencimento')" class="text-sm text-red-500">
              {{ getFieldError('vencimento') }}
            </p>
          </div>

          <div class="space-y-2">
            <label for="status" class="block text-sm font-medium">Status</label>
            <select 
              id="status" 
              formControlName="status"
              class="w-full h-10 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary"
            >
              <option *ngFor="let option of statusOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>
        </div>

        <!-- Observações -->
        <div class="space-y-2">
          <label for="observacoes" class="block text-sm font-medium">Observações</label>
          <textarea
            id="observacoes"
            formControlName="observacoes"
            placeholder="Observações adicionais sobre o faturamento"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary resize-none"
          ></textarea>
        </div>

        <!-- Form Actions -->
        <div class="flex justify-end space-x-2 pt-4 border-t">
          <ui-button 
            type="button" 
            variant="outline" 
            (onClick)="closeDialog()"
          >
            Cancelar
          </ui-button>
          <ui-button 
            type="submit"
            [disabled]="invoiceForm.invalid"
          >
            {{ isEditing ? 'Atualizar' : 'Criar' }} Faturamento
          </ui-button>
        </div>
      </form>
    </div>
  </div>
</div>
